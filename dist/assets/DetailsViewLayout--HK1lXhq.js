import{_ as V,r as d,z as D,p as z,o as L,c as n,d as e,t as r,n as g,F as h,e as C,f as O,b as c,g as T}from"./index-BVNTGA3w.js";import{u as M}from"./products-Bx2MbbLe.js";import{u as R}from"./shopCar-A9r8-SBz.js";import{u as j}from"./snack-C75NDPgZ.js";import{u as A}from"./order-GJ75ViXz.js";const G={key:0,class:"details-page"},H={class:"product-image"},J=["src"],K={class:"product-header"},Q={class:"spec-group"},W={class:"spec-options"},X=["onClick"],Y={class:"spec-group"},Z={class:"spec-options"},ee=["onClick"],te={class:"spec-group"},se={class:"extras-list"},ae=["onClick"],oe={key:0,class:"selected-icon"},le={class:"product-details"},ne={class:"detail-content"},ce={class:"bottom-bar"},re={class:"price-info"},ue={class:"current-price"},ie={class:"original-price"},de={class:"quantity-selector"},ve={class:"quantity"},pe={key:1},me={__name:"detail",setup(I){const p=M(),x=R();j();const E=D(),k=d(!1),u=d(1),S=d(!0),w=E.params.id,m=d([]),_=d([]),f=d([]),o=d(null);d(null);const b=z(()=>{var s;const a=((s=o.value)==null?void 0:s.price)||0,t=f.value.filter(l=>l.selected).reduce((l,y)=>l+y.price,0);return(a+t)*u.value});L(async()=>{try{await p.getById(w),o.value=p.product,console.log(o.value),o.value?(m.value=o.value.options.temperature,_.value=o.value.options.sugar,f.value=o.value.options.extras):console.error("未能获取到商品数据")}catch(a){console.error("获取商品详情时出错",a)}finally{S.value=!1}});const B=()=>{k.value=!k.value},$=a=>{m.value.forEach(t=>{t.default=t.name===a.name})},P=a=>{_.value.forEach(t=>{t.default=t.name===a.name})},q=a=>{a.selected=!a.selected},F=async()=>{if(o.value){const a=await p.getById(o.value.productId),t=m.value.find(i=>i.default),s=_.value.find(i=>i.default),l=f.value.filter(i=>i.selected),y={id:a.productId,name:a.name,imgUrl:a.imageUrl,type:"product",num:u.value,selectedTemperature:(t==null?void 0:t.name)||"",selectedSugar:(s==null?void 0:s.name)||"",selectedExtras:l.map(i=>i.name),price:b.value};x.addToCart(y)}alert("加入购物车成功"),history.back()},U=async()=>{if(o.value){const a=await p.getById(o.value.productId),t=m.value.find(v=>v.default),s=_.value.find(v=>v.default),l=f.value.filter(v=>v.selected),y={id:a.productId,name:a.name,imgUrl:a.imageUrl,type:"product",num:u.value,selectedTemperature:(t==null?void 0:t.name)||"",selectedSugar:(s==null?void 0:s.name)||"",selectedExtras:l.map(v=>v.name),price:b.value};await A().createOrder([y]),history.back()}},N=()=>{history.back()};return(a,t)=>S.value?(c(),n("div",pe,"加载中...")):(c(),n("div",G,[e("div",{class:"back-button",onClick:N},t[2]||(t[2]=[e("div",{class:"iconfont icon-fanhui"},null,-1)])),e("div",H,[e("img",{src:`${o.value.imageUrl}`,alt:"产品图片"},null,8,J)]),e("div",K,[e("h2",null,r(o.value.name),1),e("div",{class:"favorite",onClick:B},[e("span",{class:g(["star-icon",{filled:k.value}])},"★",2),t[3]||(t[3]=e("span",null,"收藏口味",-1))])]),e("div",Q,[t[4]||(t[4]=e("div",{class:"spec-label"},"温度",-1)),e("div",W,[(c(!0),n(h,null,C(m.value,s=>(c(),n("button",{key:s.name,class:g(["spec-option",{active:s.default}]),onClick:l=>$(s)},r(s.name),11,X))),128))])]),e("div",Y,[t[5]||(t[5]=e("div",{class:"spec-label"},"糖度",-1)),e("div",Z,[(c(!0),n(h,null,C(_.value,s=>(c(),n("button",{key:s.name,class:g(["spec-option",{active:s.default}]),onClick:l=>P(s)},r(s.name),11,ee))),128))])]),e("div",te,[t[6]||(t[6]=e("div",{class:"spec-label"},"加料",-1)),e("div",se,[(c(!0),n(h,null,C(f.value,s=>(c(),n("div",{key:s.name,class:g(["extra-option",{active:s.selected}]),onClick:l=>q(s)},[e("span",null,r(s.name)+"（¥"+r(s.price)+"）",1),s.selected?(c(),n("span",oe,"✔")):O("",!0)],10,ae))),128))])]),e("div",le,[t[7]||(t[7]=e("h3",null,"商品详情",-1)),e("div",ne,r(o.value.description),1)]),e("div",ce,[e("div",re,[e("span",ue,"¥"+r(b.value),1),e("span",ie,"¥"+r((o.value.price*u.value*1.2).toFixed(1)),1)]),e("div",de,[e("button",{class:"quantity-btn",onClick:t[0]||(t[0]=s=>u.value>1&&u.value--)},"-"),e("span",ve,r(u.value),1),e("button",{class:"quantity-btn",onClick:t[1]||(t[1]=s=>u.value++)},"+")]),e("div",{class:"action-buttons"},[e("button",{class:"buy-now-btn",onClick:U},"立即购买"),e("button",{class:"add-cart-btn",onClick:F},"加入购物车")])])]))}},_e=V(me,[["__scopeId","data-v-c6586f62"]]),he={__name:"DetailsViewLayout",setup(I){return(p,x)=>(c(),n("div",null,[T(_e)]))}};export{he as default};
